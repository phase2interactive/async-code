_format_version: "3.0"

services:
  - name: test-backend-api
    url: http://backend-test:5000
    routes:
      - name: api-route
        paths:
          - /api
        strip_path: true
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
          - OPTIONS
    plugins:
      - name: cors
        config:
          origins:
            - http://localhost:3001
            - http://frontend-test:3000
          credentials: true
          headers:
            - Accept
            - Accept-Version
            - Content-Length
            - Content-Type
            - Authorization
          exposed_headers:
            - X-Auth-Token
          max_age: 3600

  - name: test-auth-service
    url: http://backend-test:5000/auth
    routes:
      - name: auth-route
        paths:
          - /auth
        strip_path: false

  - name: test-health-check
    url: http://backend-test:5000/health
    routes:
      - name: health-route
        paths:
          - /health
        methods:
          - GET

plugins:
  - name: request-transformer
    config:
      add:
        headers:
          - X-Test-Environment:true

  - name: rate-limiting
    config:
      minute: 100
      policy: local

  - name: request-size-limiting
    config:
      allowed_payload_size: 10
      size_unit: megabytes