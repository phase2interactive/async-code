# Task: Fix Command Injection Vulnerability

**Priority**: CRITICAL
**Component**: Backend - server/utils/code_task_v2.py
**Security Impact**: High - Remote code execution

## Problem
User prompts are inadequately escaped before being used in shell commands, allowing command injection attacks.

## Vulnerable Code Locations
- Line 316-317: `user_prompt_escaped = user_prompt.replace('"', '\\"')`
- Line 364-365: Direct string interpolation in shell commands
- Line 469-470: Similar vulnerability in codex implementation

## Required Changes

1. **Use shlex.quote() for shell escaping**
   ```python
   import shlex
   user_prompt_escaped = shlex.quote(user_prompt)
   ```

2. **Avoid shell=True where possible**
   - Use subprocess with list arguments instead of shell strings
   - Pass prompts via stdin or environment variables

3. **Implement input validation**
   - Validate prompts don't contain shell metacharacters
   - Limit prompt length
   - Sanitize special characters

## Implementation Steps
1. Import shlex module
2. Replace all manual escaping with shlex.quote()
3. Refactor shell commands to avoid string interpolation
4. Add input validation for prompts
5. Add unit tests for injection attempts

## Acceptance Criteria
- [ ] All shell commands properly escape user input
- [ ] No direct string interpolation in shell commands
- [ ] Input validation prevents malicious payloads
- [ ] Unit tests verify protection against common injection attacks